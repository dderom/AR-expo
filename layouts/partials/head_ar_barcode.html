<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>{{ .Title }}</title>
    {{ if .Params.dynamic_annotations }}
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    {{else}}
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    {{end}}
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!-- Adding JS -->
      {{if .Params.dynamic_annotations }}
      {{ $dynamic_annoations := resources.Get "/js/dynamic_annotations.js" }}
      {{ $dynamic_annoations := resources.Get "/js/aframe-ar.js" }}
      {{ $context_panes := resources.Get "/js/context_panes.js" }}
      {{ $allscript := slice $dynamic_annoations $context_panes | resources.Concat "/js/vendor2.js" | minify | fingerprint }}
      {{end}}

     {{"<!-- Script to hide/show the context divs -->" | safeHTML}}
    <script>
    AFRAME.registerComponent('markerhandler', {
        init: function () {
          const marker = this.el;
          marker.addEventListener("markerFound", ()=> {
            var markerId = marker.id;
            var markerArtistDIV = 'menu-artist-' + markerId;
            var markerDescriptionDIV = 'menu-description-' + markerId;
            var markerVideoDIV = 'menu-video-' + markerId;
            var markeriframeId = 'iframe-' + markerId;
            var markerVideoDIViframe = 'context-video-' + markerId;
            var visibelvar = document.getElementById(markerArtistDIV).style.visibility = "visible";
            var visibelvar2 = document.getElementById(markerDescriptionDIV).style.visibility = "visible";
            if (document.getElementById(markerVideoDIV) !== null) {
            var visibelvar3 = document.getElementById(markerVideoDIV).style.visibility = "visible";

                $(document).ready(function(){
                    /* Get iframe src attribute value i.e. YouTube video url
                    and store it in a variable */
                    var url = $("#" + markeriframeId).attr('src');
                    console.log("Video URL: ", url);
                    /* Assign empty url value to the iframe src attribute when
                    modal hide, which stop the video playing */
                    $("#" + markerVideoDIViframe).on('hide.bs.modal', function(){
                        $("#" + markeriframeId).attr('src', '');
                        console.log("Video autoplay: ", markerVideoDIViframe);
                    });

                    /* Assign the initially stored url back to the iframe src
                    attribute when modal is displayed again */
                    $("#" + markerVideoDIViframe).on('show.bs.modal', function(){
                        $("#" + markeriframeId).attr('src', url);
                        console.log("Video autoplay: ", markerVideoDIViframe);
                    });


                });
            }
            // check if there are dynamic annotations and build these if there are

            // Now print some console
            console.log('Marker Found: ', markerId);
            console.log("visibility: ", visibelvar);
            console.log("Description ID: ", markerDescriptionDIV);
            console.log("Artist ID: ", markerArtistDIV);
            console.log("Video ID: ", markerVideoDIV);
            console.log("Video autoplay: ", markerVideoDIViframe);

          });
          marker.addEventListener("markerLost",() =>{
            var markerId = marker.id;
            var markerArtistDIV = 'menu-artist-' + markerId;
            var markerDescriptionDIV = 'menu-description-' + markerId;
            var markerVideoDIV = 'menu-video-' + markerId;
            var visibelvar = document.getElementById(markerArtistDIV).style.visibility = "hidden";
            var visibelvar2 = document.getElementById(markerDescriptionDIV).style.visibility = "hidden";
            if (document.getElementById(markerVideoDIV) !== null) {
              var visibelvar3 = document.getElementById(markerVideoDIV).style.visibility = "hidden";
            }
            console.log('Marker Lost: ', markerId);
            console.log("visibility: ", visibelvar);
            console.log("Description ID - hidden: ", markerDescriptionDIV)
            console.log("Artist ID - hidden: ", markerArtistDIV)
            console.log("Video ID - hidden: ", markerVideoDIV)
          });
        },
      });
    </script>



    <!-- Used to create dynamic annotations -->
    {{if .Params.dynamic_annotations }}
    <script>
    AFRAME.registerComponent('clickhandler', {
         init: function() {
           const pin = this.el;
           pin.addEventListener('click', () => {
                var pinId = pin.getAttribute('pin-id');
                 console.log('Dynamic annotation for ID: ', pinId)
             });
     }});
     </script>

    {{end}}

    <style>

      .menu {
         left: 0;
         width: 10%;
         height: 5em;
         display: flex;
         justify-content: center;
         align-items: center;
         z-index: 1;
         visibility: hidden;
         position: absolute;
         bottom: 0;
         float: left;
         margin-left: 2px;
      }
      .menu-artist {
        position: absolute;
        bottom: 0;
        left: 2px;
      }

      .menu-description {
        position: absolute;
        bottom: 80px;
        left: 2px;
      }

      .menu-video {
        position: absolute;
        bottom: 160px;
        left: 2px;
      }



      .btn {
        margin-bottom: 2px;
      }

      .modal-content {
        background-color:rgba(0, 0, 0, 0.5);
        border: 2px solid white;
      }

      .modal-header, .modal-body, .modal-content, .close {
        color: white;
      }
    </style>


    </head>
